# Kconfig for RustNEMU
# Based on NEMU's Kconfig structure

mainmenu "RustNEMU Configuration"

config ISA
    string
    default "riscv32"

config ISA_riscv
    bool
    default y

config RV64
    bool "RV64 (64-bit)"
    default n

config RVE
    bool "RVE (Embedded, 16 registers)"
    default n

menu "Build Options"

config CC_OPT
    string "Compiler optimization level"
    default "-O3"

config CC_LTO
    bool "Link-time optimization"
    default n

config CC_DEBUG
    bool "Debug info"
    default n

endmenu

menu "Testing and Debugging"

config TRACE
    bool "Enable trace"
    default y

if TRACE

config TRACE_START
    int "Trace start point"
    default 0

config TRACE_END
    int "Trace end point"
    default 10000

config ITRACE
    bool "Instruction trace"
    default y

if ITRACE
config ITRACE_COND
    string "Instruction trace condition"
    default "true"

config ITRACE_RINGBUF
    int "Instruction trace ring buffer size"
    default 32
endif

config MTRACE
    bool "Memory trace"
    default y

if MTRACE
config MTRACE_COND
    string "Memory trace condition"
    default "true"

config MTRACE_RINGBUF
    int "Memory trace ring buffer size"
    default 32
endif

config FTRACE
    bool "Function trace"
    default y

if FTRACE
config FTRACE_COND
    string "Function trace condition"
    default "true"

config FTRACE_BUF
    int "Function trace buffer size"
    default 1024
endif

config DTRACE
    bool "Device trace"
    default y

if DTRACE
config DTRACE_COND
    string "Device trace condition"
    default "true"

config DTRACE_RINGBUF
    int "Device trace ring buffer size"
    default 32
endif

endif # TRACE

config DIFFTEST
    bool "Differential testing"
    default n

if DIFFTEST
config DIFFTEST_REF_PATH
    string "Reference implementation path"
    default "none"

config DIFFTEST_REF_NAME
    string "Reference implementation name"
    default "none"
endif

config WATCHPOINT
    bool "Watchpoint support"
    default y

endmenu

menu "Memory Configuration"

config MBASE
    hex "Memory base address"
    default 0x80000000

config MSIZE
    hex "Memory size"
    default 0x8000000

config PC_RESET_OFFSET
    hex "PC reset offset"
    default 0

config MEM_RANDOM
    bool "Random memory initialization"
    default y

endmenu

menu "Devices"

config DEVICE
    bool "Enable devices"
    default y

if DEVICE

config HAS_SERIAL
    bool "Serial device"
    default y

if HAS_SERIAL
config SERIAL_MMIO
    hex "Serial MMIO address"
    default 0xa00003f8
endif

config HAS_TIMER
    bool "Timer device"
    default y

if HAS_TIMER
config RTC_MMIO
    hex "RTC MMIO address"
    default 0xa0000048
endif

config HAS_KEYBOARD
    bool "Keyboard device"
    default y

if HAS_KEYBOARD
config I8042_DATA_MMIO
    hex "Keyboard data MMIO address"
    default 0xa0000060
endif

config HAS_VGA
    bool "VGA device"
    default y

if HAS_VGA
config FB_ADDR
    hex "Framebuffer address"
    default 0xa1000000

config VGA_CTL_MMIO
    hex "VGA control MMIO address"
    default 0xa0000100

config VGA_SHOW_SCREEN
    bool "Show VGA screen"
    default y
endif

config HAS_AUDIO
    bool "Audio device"
    default y

if HAS_AUDIO
config SB_ADDR
    hex "Audio buffer address"
    default 0xa1200000

config SB_SIZE
    hex "Audio buffer size"
    default 0x10000

config AUDIO_CTL_MMIO
    hex "Audio control MMIO address"
    default 0xa0000200
endif

config HAS_DISK
    bool "Disk device"
    default y

if HAS_DISK
config DISK_CTL_MMIO
    hex "Disk control MMIO address"
    default 0xa0000300

config DISK_IMG_PATH
    string "Disk image path"
    default ""
endif

config HAS_CLINT
    bool "CLINT (Core Local Interruptor)"
    default y

config HAS_PLIC
    bool "PLIC (Platform-Level Interrupt Controller)"
    default y

endif # DEVICE

endmenu
